# Yandex Music Discord Rich Presence

## Установка

```bash
pip install -r requirements.txt
```

## Настройка

1. Создайте Discord Application:
   - Перейдите на https://discord.com/developers/applications
   - Нажмите "New Application"
   - Введите название (например, "Yandex Music")
   - Нажмите "Create"
   - В разделе "General Information" найдите "Application ID"
   - Скопируйте Application ID (это и есть Client ID)

2. Установите переменную окружения:

**Вариант 1: Постоянно (рекомендуется)**
Добавьте в файл `~/.zshrc`:
```bash
export DISCORD_CLIENT_ID="1450951913175519366"
```

Откройте файл:
```bash
nano ~/.zshrc
```

Добавьте строку в конец файла, сохраните (Ctrl+O, Enter, Ctrl+X) и выполните:
```bash
source ~/.zshrc
```

**Вариант 2: Временно (только для текущей сессии терминала)**
```bash
export DISCORD_CLIENT_ID="1450951913175519366"
```
⚠️ Эта переменная исчезнет после закрытия терминала

3. Получите cookies из браузера:
   - Откройте https://music.yandex.ru в браузере
   - Войдите в аккаунт
   - Откройте DevTools (F12 или Cmd+Option+I на Mac)
   - Перейдите во вкладку "Application" (или "Хранилище")
   - В левом меню выберите "Cookies" → `https://music.yandex.ru`
   - Найдите cookies `Session_id` и `yandexuid`
   - Скопируйте их значения
   - Создайте файл `~/.yandex_music_cookies.json` со следующим содержимым:
   ```json
   {
     "Session_id": "ваш_session_id",
     "yandexuid": "ваш_yandexuid"
   }
   ```

## Запуск

**Важно:** Сервер должен быть запущен постоянно, пока вы хотите видеть статус в Discord.

### Способ 1: Использование start_server.sh (рекомендуется)

Просто запустите скрипт:
```bash
./start_server.sh
```

Скрипт автоматически:
- Установит переменную окружения `DISCORD_CLIENT_ID`
- Проверит, не запущен ли уже сервер
- Запустит сервер

**Важно:** Если вы добавили `DISCORD_CLIENT_ID` в `~/.zshrc`, можно использовать `./launch.sh` вместо этого скрипта.

### Способ 2: Прямой запуск

```bash
python3 server.py
```
Вы должны увидеть сообщение "Server started on http://localhost:8080"

### Автозапуск сервера (опционально)

Чтобы сервер запускался автоматически, добавьте алиас в файл `~/.zshrc`:

1. Откройте файл в редакторе:
```bash
nano ~/.zshrc
```
   Или используйте любой другой редактор (VS Code, TextEdit и т.д.)

2. Добавьте в конец файла:
```bash
# Yandex Music Discord RPC
alias yandex-rpc='cd /Users/emoji/Documents/school/yandexextencion && python3 server.py &'
```

3. Сохраните файл и перезагрузите конфигурацию:
```bash
source ~/.zshrc
```

Теперь вы можете запускать сервер командой `yandex-rpc` из любого места.

2. Установите расширение браузера:
   - Откройте Chrome/Edge
   - Перейдите на `chrome://extensions/` (или `edge://extensions/`)
   - Включите "Режим разработчика" (Developer mode)
   - Нажмите "Загрузить распакованное расширение" (Load unpacked)
   - Выберите папку `extension` из этого проекта

3. Откройте https://music.yandex.ru и начните воспроизведение музыки

Расширение будет автоматически отправлять информацию о текущем треке на локальный сервер (localhost:8080), который обновит ваш статус в Discord.

## Устранение проблем

### Статус не отображается в Discord

**Шаг 1: Проверьте подключение к Discord**

Запустите тестовый скрипт:
```bash
python3 test_discord.py
```

Если видите ошибку "Discord не найден" или "Discord отклонил подключение":
- **Убедитесь, что Discord запущен** (десктопная версия, не веб)
- Перезапустите Discord
- Убедитесь, что используете правильный Client ID

**Шаг 2: Проверьте настройки Discord**

1. Откройте Discord
2. Перейдите в **Settings** → **Activity Privacy** (или **Настройки** → **Конфиденциальность активности**)
3. Убедитесь, что включено:
   - ✅ **"Display current activity as a status message"** (Отображать активность в качестве статуса)
   - ✅ **"Allow access to game activity"** (Разрешить доступ к активности игры)

**Шаг 3: Проверьте сервер**

1. **Проверьте статус сервера:**
   ```bash
   curl http://localhost:8080
   ```
   Должен вернуться JSON с информацией о текущем треке

2. **Проверьте логи сервера:**
   - При запуске должно быть: "✅ Успешно подключено к Discord!"
   - При обновлении трека должно быть: "✅ Discord обновлен: [название] - [исполнитель]"

**Шаг 4: Проверьте расширение браузера**

1. Откройте DevTools (F12) на странице music.yandex.ru
2. Во вкладке Console должны быть сообщения: "Track: [название] - [исполнитель]"
3. Если сообщений нет, перезагрузите расширение в `chrome://extensions/`

**Шаг 5: Перезапустите всё**

1. Остановите сервер (Ctrl+C в терминале)
2. Убедитесь, что Discord запущен
3. Запустите сервер снова: `./launch.sh`
4. Обновите страницу music.yandex.ru

# YandexMusicDiscordPresence
